<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Framd</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@400;500;600&family=Bebas+Neue&family=Oswald:wght@700&family=Montserrat:wght@900&family=Poppins:wght@800&family=Anton&family=Roboto+Condensed:wght@700&family=Archivo+Black&family=Bangers&family=Playfair+Display:wght@500;600&display=swap">
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body data-user-email="{{ user.email if user else 'user@example.com' }}" data-user-name="{{ user.name if user and user.name else (user.email.split('@')[0] if user else 'User') }}">
    <!-- Global Loading Bar -->
    <div id="global-loading-bar" class="global-loading-bar">
        <div id="global-loading-fill" class="global-loading-fill"></div>
    </div>
    
    <div class="app">
        <header>
            <div class="header-left">
                <div class="brand" onclick="goToProjects()">Framd <span class="pro-badge" id="pro-badge">PRO</span></div>
                <div class="back-to-projects" id="back-to-projects" onclick="goToProjects()">← Back to projects</div>
            </div>
            <div class="header-center">
                <div class="project-name-display empty" id="project-name-display" onclick="editProjectName()">
                    <span id="project-name-text">Untitled</span>
                    <svg class="edit-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                </div>
            </div>
            <div class="header-right">
                <div class="save-indicator" id="save-indicator" style="display: none;">
                    <svg class="save-icon saved" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"/>
                    </svg>
                    <svg class="save-icon saving" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                    </svg>
                    <span class="save-text">Saved</span>
                </div>
                <div class="token-balance-pill" id="header-token-pill" onclick="openSettings('billing')" title="Click to manage tokens">
                    <span class="token-icon">✦</span>
                    <span class="token-count" id="header-token-count">--</span>
                    <span>tokens</span>
                </div>
                <button class="quick-action-btn" onclick="startNewProject()" title="New Project">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                </button>
                <button class="avatar-btn" id="avatar-btn" onclick="toggleAvatarMenu()">
                    {{ current_user.username[0].upper() if current_user and current_user.username else 'U' }}
                </button>
                <div class="avatar-menu" id="avatar-menu">
                    <a href="#" class="avatar-menu-item" onclick="goToProjects(); toggleAvatarMenu();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        Projects
                    </a>
                    <a href="#" class="avatar-menu-item" onclick="openSettings('profile'); toggleAvatarMenu();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Profile
                    </a>
                    <a href="#" class="avatar-menu-item" onclick="openSettings('billing'); toggleAvatarMenu();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="1" y="4" width="22" height="16" rx="2"/><line x1="1" y1="10" x2="23" y2="10"/>
                        </svg>
                        Billing
                    </a>
                    <a href="#" class="avatar-menu-item" onclick="openSettings('privacy'); toggleAvatarMenu();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                        </svg>
                        Privacy
                    </a>
                    <div class="avatar-menu-divider"></div>
                    <a href="/logout" class="avatar-menu-item logout">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                        Logout
                    </a>
                </div>
            </div>
        </header>
        
        <!-- PROJECT DASHBOARD OVERLAY -->
        <div class="dashboard-overlay" id="dashboard-overlay" onclick="closeDashboard(event)">
            <div class="dashboard-panel">
                <div class="dashboard-header">
                    <h2>Your Projects</h2>
                    <button class="close-dashboard" onclick="toggleDashboard()">&times;</button>
                </div>
                
                <!-- Build New / Generator Tabs -->
                <div class="dashboard-tabs" style="display: flex; gap: 0; margin-bottom: 16px; border-radius: 12px; overflow: hidden; border: 1px solid var(--border);">
                    <button class="dashboard-tab active" id="tab-build-new" onclick="switchDashboardTab('build-new')" style="flex: 1; padding: 12px 16px; background: var(--gold); color: var(--bg); border: none; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                        Build New
                    </button>
                    <button class="dashboard-tab" id="tab-generator" onclick="switchDashboardTab('generator')" style="flex: 1; padding: 12px 16px; background: rgba(255,255,255,0.03); color: var(--text-dim); border: none; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.2s; position: relative;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                        Generator
                        <span id="generator-lock-badge" class="generator-lock-badge" style="position: absolute; top: 4px; right: 8px; font-size: 9px; padding: 2px 6px; background: rgba(255,214,10,0.2); border: 1px solid var(--gold); border-radius: 8px; color: var(--gold);">PRO</span>
                    </button>
                </div>
                
                <!-- Tab Content: Build New -->
                <div id="tab-content-build-new" class="dashboard-tab-content">
                <!-- Token Balance Display -->
                <div class="token-balance-header" style="background: linear-gradient(135deg, rgba(255,214,10,0.15), rgba(255,214,10,0.05)); border: 1px solid rgba(255,214,10,0.2); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <div>
                            <div style="font-size: 11px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">Token Balance</div>
                            <div style="display: flex; align-items: baseline; gap: 8px;">
                                <span id="dashboard-token-balance" style="font-size: 32px; font-weight: 700; color: var(--gold);">0</span>
                                <span style="font-size: 13px; color: var(--text-dim);">tokens</span>
                            </div>
                        </div>
                        <a href="/pricing" style="font-size: 12px; color: var(--gold); text-decoration: none; padding: 8px 16px; border: 1px solid var(--gold); border-radius: 20px; transition: all 0.2s;" onmouseover="this.style.background='var(--gold)';this.style.color='var(--bg)'" onmouseout="this.style.background='transparent';this.style.color='var(--gold)'">Get More</a>
                    </div>
                    <div style="display: flex; gap: 8px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 12px;">
                        <button onclick="showVideoHistory()" style="flex: 1; padding: 8px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                            Video History
                        </button>
                        <button onclick="showEmailSettings()" style="flex: 1; padding: 8px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                            Email Alerts
                        </button>
                    </div>
                </div>
                
                <div class="ai-learning-section">
                    <div class="learning-header">
                        <h3>Echo Engine Learning</h3>
                        <span class="learning-status" id="learning-status">Learning...</span>
                    </div>
                    <div class="learning-progress-full">
                        <div class="learning-bar-full" id="learning-bar-full" style="width: 0%"></div>
                    </div>
                    <div class="learning-stats">
                        <div class="stat">
                            <span class="stat-value" id="total-projects">0</span>
                            <span class="stat-label">Projects</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="successful-projects">0</span>
                            <span class="stat-label">Successful</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value" id="learning-progress-stat">0%</span>
                            <span class="stat-label">Progress</span>
                        </div>
                    </div>
                    <p class="learning-tip" id="learning-tip">Like more videos to help Echo Engine learn your style.</p>
                </div>
                
                <!-- Trend Intelligence Section -->
                <div class="ai-learning-section" style="background: linear-gradient(135deg, rgba(78,205,196,0.08), rgba(78,205,196,0.02)); border-color: rgba(78,205,196,0.15);">
                    <div class="learning-header">
                        <h3 style="display: flex; align-items: center; gap: 8px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#4ECDC4" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            Trend Intelligence
                        </h3>
                        <span class="learning-status" style="color: #4ECDC4;">Active</span>
                    </div>
                    <p style="font-size: 12px; color: var(--text-dim); margin-bottom: 12px;">
                        AI researches how your topic is being discussed across platforms before creating content.
                    </p>
                    <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                        <span style="font-size: 10px; padding: 4px 8px; background: rgba(78,205,196,0.1); border: 1px solid rgba(78,205,196,0.2); border-radius: 12px; color: #4ECDC4;">Twitter</span>
                        <span style="font-size: 10px; padding: 4px 8px; background: rgba(78,205,196,0.1); border: 1px solid rgba(78,205,196,0.2); border-radius: 12px; color: #4ECDC4;">Instagram</span>
                        <span style="font-size: 10px; padding: 4px 8px; background: rgba(78,205,196,0.1); border: 1px solid rgba(78,205,196,0.2); border-radius: 12px; color: #4ECDC4;">TikTok</span>
                        <span style="font-size: 10px; padding: 4px 8px; background: rgba(78,205,196,0.1); border: 1px solid rgba(78,205,196,0.2); border-radius: 12px; color: #4ECDC4;">YouTube</span>
                    </div>
                    <p style="font-size: 11px; color: var(--text-dim); margin-top: 10px; font-style: italic;">
                        Discovers successful hooks, formats, and visuals for your topic.
                    </p>
                </div>
                
                <!-- Generator Settings -->
                <div class="generator-settings-section">
                    <div class="settings-header">
                        <h3>Generator Settings</h3>
                        <button class="settings-toggle-btn" onclick="toggleGeneratorSettings()">
                            <span id="settings-toggle-icon">▶</span> Configure
                        </button>
                    </div>
                    <div class="settings-body" id="generator-settings-body">
                        <div class="setting-row">
                            <span class="setting-label">Tone</span>
                            <div class="setting-control">
                                <select id="setting-tone" onchange="updateGeneratorSetting('tone', this.value)">
                                    <option value="neutral">Neutral</option>
                                    <option value="passionate">Passionate</option>
                                    <option value="calm">Calm</option>
                                    <option value="urgent">Urgent</option>
                                    <option value="witty">Witty</option>
                                </select>
                            </div>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Format</span>
                            <div class="setting-control">
                                <select id="setting-format" onchange="updateGeneratorSetting('format_type', this.value)">
                                    <option value="explainer">Explainer</option>
                                    <option value="opinion">Opinion</option>
                                    <option value="story">Story</option>
                                    <option value="breakdown">Breakdown</option>
                                </select>
                            </div>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Length</span>
                            <div class="setting-control" style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="range" id="setting-length" min="35" max="75" value="45" 
                                       oninput="updateLengthDisplay(this.value)"
                                       onchange="updateGeneratorSetting('target_length', this.value)">
                                <span class="length-display" id="length-display">45s</span>
                            </div>
                        </div>
                        <div class="setting-row">
                            <span class="setting-label">Voice Style</span>
                            <div class="setting-control">
                                <select id="setting-voice" onchange="updateGeneratorSetting('voice_style', this.value)">
                                    <option value="news_anchor">News Anchor</option>
                                    <option value="storyteller">Storyteller</option>
                                    <option value="pundit">Pundit</option>
                                    <option value="educator">Educator</option>
                                    <option value="conversational">Conversational</option>
                                </select>
                            </div>
                        </div>
                        <div class="setting-row" style="flex-direction: column; align-items: flex-start;">
                            <span class="setting-label">Topics</span>
                            <div class="topic-toggles" id="topic-toggles">
                                <button class="topic-toggle" data-topic="politics" onclick="toggleTopic(this)">Politics</button>
                                <button class="topic-toggle" data-topic="tech" onclick="toggleTopic(this)">Tech</button>
                                <button class="topic-toggle" data-topic="culture" onclick="toggleTopic(this)">Culture</button>
                                <button class="topic-toggle" data-topic="economics" onclick="toggleTopic(this)">Economics</button>
                                <button class="topic-toggle" data-topic="science" onclick="toggleTopic(this)">Science</button>
                                <button class="topic-toggle" data-topic="philosophy" onclick="toggleTopic(this)">Philosophy</button>
                            </div>
                        </div>
                    </div>
                    <div class="auto-gen-status" id="auto-gen-status">
                        <span class="status-icon" id="auto-gen-icon"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></span>
                        <span class="status-text" id="auto-gen-text">0/5 videos liked to unlock</span>
                    </div>
                </div>
                
                <div class="projects-list" id="projects-list">
                    <div class="loading-projects">Loading projects...</div>
                </div>
                
                <button class="new-project-btn" onclick="createNewProject()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    New Project
                </button>
                </div><!-- End Tab Content: Build New -->
                
                <!-- Tab Content: Generator (Pro + 5 Likes Required) -->
                <div id="tab-content-generator" class="dashboard-tab-content" style="display: none;">
                    <div id="generator-locked-state" style="text-align: center; padding: 40px 20px;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, rgba(255,214,10,0.2), rgba(255,214,10,0.05)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                            </svg>
                        </div>
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 8px;">AI Auto-Generator</h3>
                        <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 16px; line-height: 1.5;">
                            Let Echo Engine create content drafts for you, using trend research and everything it's learned from your style.
                        </p>
                        <div style="display: flex; flex-direction: column; gap: 8px; max-width: 260px; margin: 0 auto 20px;">
                            <div id="generator-req-pro" style="display: flex; align-items: center; gap: 10px; padding: 10px 16px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 8px;">
                                <span id="generator-check-pro" style="width: 20px; height: 20px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 12px;">-</span>
                                <span style="font-size: 13px;">Pro subscription</span>
                            </div>
                            <div id="generator-req-likes" style="display: flex; align-items: center; gap: 10px; padding: 10px 16px; background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 8px;">
                                <span id="generator-check-likes" style="width: 20px; height: 20px; border-radius: 50%; background: rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; font-size: 12px;">-</span>
                                <span style="font-size: 13px;"><span id="generator-likes-count">0</span>/5 liked videos</span>
                            </div>
                        </div>
                        <a href="/pricing" style="display: inline-block; padding: 12px 24px; background: var(--gold); color: var(--bg); text-decoration: none; border-radius: 8px; font-weight: 600; font-size: 14px;">Upgrade to Pro</a>
                    </div>
                    
                    <div id="generator-unlocked-state" style="display: none;">
                        <!-- Daily Limit Settings -->
                        <div style="background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <span style="font-size: 13px; font-weight: 500;">Daily Draft Limit</span>
                                <span id="daily-limit-value" style="font-size: 14px; font-weight: 600; color: var(--gold);">3</span>
                            </div>
                            <input type="range" id="daily-limit-slider" min="1" max="10" value="3" 
                                style="width: 100%; accent-color: var(--gold); cursor: pointer;"
                                oninput="updateDailyLimitDisplay(this.value)"
                                onchange="saveDailyLimit(this.value)">
                            <div style="display: flex; justify-content: space-between; font-size: 10px; color: var(--text-dim); margin-top: 4px;">
                                <span>1</span>
                                <span>5</span>
                                <span>10</span>
                            </div>
                            <div style="margin-top: 12px; display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 12px; color: var(--text-dim);">Used today:</span>
                                <span id="drafts-generated-today" style="font-size: 12px; color: var(--gold);">0</span>
                                <span style="font-size: 12px; color: var(--text-dim);">/</span>
                                <span id="drafts-today-limit" style="font-size: 12px; color: var(--text-dim);">3</span>
                                <span style="font-size: 12px; color: var(--text-dim);">(<span id="drafts-remaining" style="color: var(--gold);">3</span> left)</span>
                            </div>
                        </div>
                        
                        <div style="background: linear-gradient(135deg, rgba(255,214,10,0.1), rgba(255,214,10,0.03)); border: 1px solid rgba(255,214,10,0.2); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                <h3 style="font-size: 15px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                                    AI Draft Queue
                                </h3>
                                <button id="generate-more-btn" onclick="generateMoreDrafts()" style="padding: 8px 16px; background: var(--gold); color: var(--bg); border: none; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px;">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                                    Generate Drafts
                                </button>
                            </div>
                            <p style="font-size: 12px; color: var(--text-dim); margin-bottom: 0;">
                                Each draft uses a unique angle, vibe, and hook style informed by trend research.
                            </p>
                        </div>
                        
                        <div id="generator-drafts-list" style="display: flex; flex-direction: column; gap: 12px;">
                            <div class="generator-empty-state" style="text-align: center; padding: 40px 20px; background: rgba(255,255,255,0.02); border: 1px dashed var(--border); border-radius: 12px;">
                                <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 12px;">No drafts yet. Click "Generate Drafts" to create up to 3 AI-powered content drafts.</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
                            <p style="font-size: 11px; color: var(--text-dim); text-align: center; margin-bottom: 12px;">
                                Drafts are generated using trend research across Twitter, Instagram, TikTok, and YouTube.
                            </p>
                            <button onclick="createVideoUnlimited()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                                Create a Video
                            </button>
                            <p style="font-size: 10px; color: var(--text-dim); text-align: center; margin-top: 8px;">
                                No daily limit. Each video goes through like/dislike feedback.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PROJECTS DASHBOARD STAGE (Initial View) -->
        <div class="stage active" id="stage-projects">
            <div class="projects-dashboard">
                <!-- Auto-generate banner moved into project cards -->
                <div class="projects-grid" id="dashboard-projects-grid">
                </div>
            </div>
            <button class="fab-new-project" onclick="showTemplatePickerModal()" title="New Project">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
            </button>
        </div>
        
        <!-- TEMPLATE PICKER MODAL -->
        <div class="template-picker-modal" id="template-picker-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 10000; align-items: center; justify-content: center;">
            <div style="background: var(--bg); border: 1px solid var(--border); border-radius: 16px; padding: 24px; max-width: 440px; width: 90%; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <h3 style="font-size: 18px; font-weight: 600;">Choose a Template</h3>
                    <button onclick="closeTemplatePickerModal()" style="background: none; border: none; color: var(--text-dim); font-size: 24px; cursor: pointer; padding: 0; line-height: 1;">&times;</button>
                </div>
                <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 20px;">All templates include integrated video clipping and AI visual curation.</p>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 20px;">
                    <div onclick="createProjectFromTemplate('hot_take'); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(255,214,10,0.08); border: 1px solid rgba(255,214,10,0.2); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                        <div style="margin-bottom: 8px; color: #ffd60a;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">Hot Take</div>
                        <div style="font-size: 11px; color: var(--text-dim);">30-45s opinion piece</div>
                    </div>
                    <div onclick="createProjectFromTemplate('explainer'); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(78,205,196,0.08); border: 1px solid rgba(78,205,196,0.2); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                        <div style="margin-bottom: 8px; color: #4ecdc4;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">Explainer</div>
                        <div style="font-size: 11px; color: var(--text-dim);">45-60s breakdown</div>
                    </div>
                    <div onclick="createProjectFromTemplate('story'); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(155,89,182,0.08); border: 1px solid rgba(155,89,182,0.2); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                        <div style="margin-bottom: 8px; color: #9b59b6;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">Story Time</div>
                        <div style="font-size: 11px; color: var(--text-dim);">60-75s narrative</div>
                    </div>
                    <div onclick="createProjectFromTemplate('commentary'); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(231,76,60,0.08); border: 1px solid rgba(231,76,60,0.2); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                        <div style="margin-bottom: 8px; color: #e74c3c;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 20H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v1"/><path d="M18 14h3"/><path d="M18 18h3"/><path d="M18 10h3"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">Commentary</div>
                        <div style="font-size: 11px; color: var(--text-dim);">35-50s reaction</div>
                    </div>
                    <div onclick="createProjectFromTemplate('letter'); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(46,204,113,0.08); border: 1px solid rgba(46,204,113,0.2); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                        <div style="margin-bottom: 8px; color: #2ecc71;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">Open Letter</div>
                        <div style="font-size: 11px; color: var(--text-dim);">45-60s direct address</div>
                    </div>
                    <div onclick="createProjectFromTemplate('meme'); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(255,165,0,0.08); border: 1px solid rgba(255,165,0,0.2); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                        <div style="margin-bottom: 8px; color: #ffa500;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">Meme / Funny</div>
                        <div style="font-size: 11px; color: var(--text-dim);">Trend-driven comedy</div>
                    </div>
                    <div onclick="createProjectFromTemplate('ad'); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(52,152,219,0.08); border: 1px solid rgba(52,152,219,0.2); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                        <div style="margin-bottom: 8px; color: #3498db;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">Make an Ad</div>
                        <div style="font-size: 11px; color: var(--text-dim);">Product promo video</div>
                    </div>
                    <div onclick="createProjectFromTemplate('tiktok_edit'); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(238,88,166,0.08); border: 1px solid rgba(238,88,166,0.2); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                        <div style="margin-bottom: 8px; color: #ee58a6;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">TikTok Edit</div>
                        <div style="font-size: 11px; color: var(--text-dim);">Beat-synced visual edit</div>
                    </div>
                    <div onclick="openCustomTemplateCreator(); closeTemplatePickerModal();" style="cursor: pointer; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 16px; transition: all 0.2s; grid-column: span 2;">
                        <div style="margin-bottom: 8px; color: var(--text-dim);"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg></div>
                        <div style="font-weight: 600; font-size: 14px; margin-bottom: 4px;">Custom Template</div>
                        <div style="font-size: 11px; color: var(--text-dim);">Upload a video to learn its style</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- POST-RENDER VIDEO EDITOR MODAL -->
        <div class="video-editor-modal" id="video-editor-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; overflow-y: auto;">
            <div style="max-width: 800px; margin: 20px auto; padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: 600; color: var(--gold);">Edit Your Video</h3>
                    <button onclick="closeVideoEditor()" style="background: none; border: none; color: var(--text); font-size: 28px; cursor: pointer;">&times;</button>
                </div>
                
                <!-- Video Preview -->
                <div style="background: #000; border-radius: 12px; overflow: hidden; margin-bottom: 20px; position: relative;">
                    <video id="editor-video" controls style="width: 100%; max-height: 50vh;">
                        Your browser does not support video.
                    </video>
                    <!-- Caption Preview Overlay -->
                    <div id="caption-preview-overlay" style="position: absolute; bottom: 0; left: 0; right: 0; pointer-events: none; display: flex; justify-content: center; padding: 20px;">
                        <div id="preview-caption" style="background: rgba(0,0,0,0.8); color: white; padding: 8px 16px; border-radius: 8px; font-size: 18px; font-weight: 600; text-align: center;">
                            Preview Caption Text
                        </div>
                    </div>
                </div>
                
                <!-- Editor Controls -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Caption Position -->
                    <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 12px; padding: 16px;">
                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--gold);">Caption Position</h4>
                        <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                            <button onclick="setCaptionPosition('top')" class="position-btn" data-pos="top" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text); cursor: pointer;">Top</button>
                            <button onclick="setCaptionPosition('middle')" class="position-btn" data-pos="middle" style="flex: 1; padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text); cursor: pointer;">Middle</button>
                            <button onclick="setCaptionPosition('bottom')" class="position-btn active" data-pos="bottom" style="flex: 1; padding: 10px; background: var(--gold); border: 1px solid var(--gold); border-radius: 8px; color: var(--bg); cursor: pointer;">Bottom</button>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <label style="font-size: 12px; color: var(--text-dim); display: block; margin-bottom: 6px;">Vertical Offset</label>
                            <input type="range" id="caption-offset" min="0" max="100" value="10" oninput="updateCaptionOffset(this.value)" style="width: 100%; accent-color: var(--gold);">
                        </div>
                    </div>
                    
                    <!-- Caption Style -->
                    <div style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 12px; padding: 16px;">
                        <h4 style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--gold);">Caption Style</h4>
                        <div style="margin-bottom: 12px;">
                            <label style="font-size: 12px; color: var(--text-dim); display: block; margin-bottom: 6px;">Font Size</label>
                            <input type="range" id="caption-size" min="14" max="36" value="22" oninput="updateCaptionSize(this.value)" style="width: 100%; accent-color: var(--gold);">
                        </div>
                        <div style="margin-bottom: 12px;">
                            <label style="font-size: 12px; color: var(--text-dim); display: block; margin-bottom: 6px;">Background Opacity</label>
                            <input type="range" id="caption-opacity" min="0" max="100" value="80" oninput="updateCaptionOpacity(this.value)" style="width: 100%; accent-color: var(--gold);">
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="setCaptionColor('#ffffff')" style="width: 32px; height: 32px; background: #fff; border: 2px solid var(--border); border-radius: 6px; cursor: pointer;"></button>
                            <button onclick="setCaptionColor('#ffd60a')" style="width: 32px; height: 32px; background: #ffd60a; border: 2px solid var(--border); border-radius: 6px; cursor: pointer;"></button>
                            <button onclick="setCaptionColor('#4ECDC4')" style="width: 32px; height: 32px; background: #4ECDC4; border: 2px solid var(--border); border-radius: 6px; cursor: pointer;"></button>
                            <button onclick="setCaptionColor('#E74C3C')" style="width: 32px; height: 32px; background: #E74C3C; border: 2px solid var(--border); border-radius: 6px; cursor: pointer;"></button>
                        </div>
                    </div>
                </div>
                
                <!-- Individual Caption Editor -->
                <div style="margin-top: 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 12px; padding: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h4 style="font-size: 14px; font-weight: 600; color: var(--gold);">Edit Captions</h4>
                        <button onclick="addNewCaption()" style="padding: 6px 12px; background: transparent; border: 1px solid var(--gold); border-radius: 6px; color: var(--gold); font-size: 12px; cursor: pointer;">+ Add Caption</button>
                    </div>
                    <div id="caption-list" style="max-height: 200px; overflow-y: auto;">
                        <div style="color: var(--text-dim); font-size: 13px; text-align: center; padding: 20px;">Loading captions...</div>
                    </div>
                </div>
                
                <!-- Save Preset Option -->
                <div style="margin-top: 20px; padding: 16px; background: rgba(255,214,10,0.08); border: 1px solid rgba(255,214,10,0.2); border-radius: 12px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="save-as-preset" style="accent-color: var(--gold); width: 18px; height: 18px;">
                        <span style="font-size: 14px;">Save as my default style (AI will remember this)</span>
                    </label>
                </div>
                
                <!-- Action Buttons -->
                <div style="display: flex; gap: 12px; margin-top: 20px; justify-content: flex-end;">
                    <button onclick="closeVideoEditor()" style="padding: 12px 24px; background: transparent; border: 1px solid var(--border); border-radius: 8px; color: var(--text); cursor: pointer;">Cancel</button>
                    <button onclick="applyEditorChanges()" style="padding: 12px 24px; background: var(--gold); border: none; border-radius: 8px; color: var(--bg); font-weight: 600; cursor: pointer;">Re-render with Changes</button>
                </div>
            </div>
        </div>
        
        <!-- VIDEO HISTORY MODAL -->
        <div class="video-history-modal" id="video-history-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; overflow-y: auto;">
            <div style="max-width: 600px; margin: 40px auto; padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: 600; color: var(--gold);">Video History</h3>
                    <button onclick="closeVideoHistory()" style="background: none; border: none; color: var(--text); font-size: 28px; cursor: pointer;">&times;</button>
                </div>
                <p style="color: var(--text-dim); font-size: 14px; margin-bottom: 20px;">Re-download your previously generated videos</p>
                <div id="video-history-list" style="display: flex; flex-direction: column; gap: 12px;">
                    <div style="text-align: center; padding: 40px; color: var(--text-dim);">Loading...</div>
                </div>
            </div>
        </div>
        
        <!-- EMAIL SETTINGS MODAL -->
        <div class="email-settings-modal" id="email-settings-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; overflow-y: auto;">
            <div style="max-width: 400px; margin: 60px auto; padding: 24px; background: var(--bg); border: 1px solid var(--border); border-radius: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: var(--gold);">Email Notifications</h3>
                    <button onclick="closeEmailSettings()" style="background: none; border: none; color: var(--text); font-size: 24px; cursor: pointer;">&times;</button>
                </div>
                <div style="display: flex; flex-direction: column; gap: 16px;">
                    <label style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; cursor: pointer;">
                        <div>
                            <div style="font-weight: 500; font-size: 14px;">Video Ready</div>
                            <div style="font-size: 12px; color: var(--text-dim);">Get notified when your video is done</div>
                        </div>
                        <input type="checkbox" id="email-video-ready" checked style="accent-color: var(--gold); width: 20px; height: 20px;">
                    </label>
                    <label style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; cursor: pointer;">
                        <div>
                            <div style="font-weight: 500; font-size: 14px;">Low Tokens Warning</div>
                            <div style="font-size: 12px; color: var(--text-dim);">Alert when tokens drop below 20</div>
                        </div>
                        <input type="checkbox" id="email-low-tokens" checked style="accent-color: var(--gold); width: 20px; height: 20px;">
                    </label>
                    <label style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; cursor: pointer;">
                        <div>
                            <div style="font-weight: 500; font-size: 14px;">Weekly Digest</div>
                            <div style="font-size: 12px; color: var(--text-dim);">Summary of your activity</div>
                        </div>
                        <input type="checkbox" id="email-weekly-digest" style="accent-color: var(--gold); width: 20px; height: 20px;">
                    </label>
                </div>
                <button onclick="saveEmailSettings()" style="width: 100%; margin-top: 20px; padding: 14px; background: var(--gold); border: none; border-radius: 8px; color: var(--bg); font-weight: 600; cursor: pointer;">Save Preferences</button>
            </div>
        </div>
        
        <!-- PLATFORM EXPORT MODAL -->
        <div id="platform-export-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; overflow-y: auto;">
            <div style="max-width: 500px; margin: 60px auto; padding: 24px; background: var(--bg); border: 1px solid var(--border); border-radius: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: var(--gold);">Export to Platforms</h3>
                    <button onclick="closePlatformExport()" style="background: none; border: none; color: var(--text); font-size: 24px; cursor: pointer;">&times;</button>
                </div>
                <p style="font-size: 13px; color: var(--text-dim); margin-bottom: 16px;">Select platforms to export your video in optimized formats</p>
                <div id="platform-options" style="display: flex; flex-direction: column; gap: 10px;">
                    <label style="display: flex; align-items: center; gap: 12px; padding: 14px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 10px; cursor: pointer;">
                        <input type="checkbox" name="platform" value="tiktok" checked style="accent-color: var(--gold); width: 18px; height: 18px;">
                        <div style="flex: 1;"><div style="font-weight: 500;">TikTok</div><div style="font-size: 11px; color: var(--text-dim);">9:16 vertical, optimized for FYP</div></div>
                    </label>
                    <label style="display: flex; align-items: center; gap: 12px; padding: 14px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 10px; cursor: pointer;">
                        <input type="checkbox" name="platform" value="instagram" checked style="accent-color: var(--gold); width: 18px; height: 18px;">
                        <div style="flex: 1;"><div style="font-weight: 500;">Instagram Reels</div><div style="font-size: 11px; color: var(--text-dim);">9:16 vertical, Reels-ready</div></div>
                    </label>
                    <label style="display: flex; align-items: center; gap: 12px; padding: 14px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 10px; cursor: pointer;">
                        <input type="checkbox" name="platform" value="youtube" checked style="accent-color: var(--gold); width: 18px; height: 18px;">
                        <div style="flex: 1;"><div style="font-weight: 500;">YouTube Shorts</div><div style="font-size: 11px; color: var(--text-dim);">9:16 vertical, up to 60 seconds</div></div>
                    </label>
                    <label style="display: flex; align-items: center; gap: 12px; padding: 14px; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 10px; cursor: pointer;">
                        <input type="checkbox" name="platform" value="twitter" style="accent-color: var(--gold); width: 18px; height: 18px;">
                        <div style="flex: 1;"><div style="font-weight: 500;">Twitter/X</div><div style="font-size: 11px; color: var(--text-dim);">16:9 horizontal, max engagement</div></div>
                    </label>
                </div>
                <div id="export-progress" style="display: none; margin-top: 16px; padding: 12px; background: rgba(255,214,10,0.1); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--gold); margin-bottom: 8px;">Generating formats...</div>
                    <div style="height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden;">
                        <div id="export-progress-bar" style="width: 0%; height: 100%; background: var(--gold); transition: width 0.3s;"></div>
                    </div>
                </div>
                <button onclick="startPlatformExport()" id="export-btn" style="width: 100%; margin-top: 20px; padding: 14px; background: var(--gold); border: none; border-radius: 8px; color: var(--bg); font-weight: 600; cursor: pointer;">Export Selected Formats</button>
            </div>
        </div>
        
        <!-- PROMO PACK MODAL -->
        <div id="promo-pack-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; overflow-y: auto;">
            <div style="max-width: 700px; margin: 40px auto; padding: 24px; background: var(--bg); border: 1px solid var(--border); border-radius: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: var(--gold);">Promo Pack</h3>
                    <button onclick="closePromoPack()" style="background: none; border: none; color: var(--text); font-size: 24px; cursor: pointer;">&times;</button>
                </div>
                <p style="font-size: 13px; color: var(--text-dim); margin-bottom: 20px;">AI-generated shareable content to boost your video's reach</p>
                
                <div id="promo-loading" style="text-align: center; padding: 40px;">
                    <div class="loading-spinner" style="margin: 0 auto 16px;"></div>
                    <div style="color: var(--text-dim);">Generating promo content...</div>
                </div>
                
                <div id="promo-content" style="display: none;">
                    <!-- Quote Cards -->
                    <div style="margin-bottom: 24px;">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--gold);">Quote Cards</div>
                        <div id="quote-cards-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;"></div>
                    </div>
                    
                    <!-- Memes (if funny content detected) -->
                    <div id="memes-section" style="display: none; margin-bottom: 24px;">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--gold);">Memes</div>
                        <div id="memes-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;"></div>
                    </div>
                    
                    <!-- Infographics -->
                    <div style="margin-bottom: 24px;">
                        <div style="font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--gold);">Key Stats & Infographics</div>
                        <div id="infographics-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;"></div>
                    </div>
                </div>
                
                <div id="promo-actions" style="display: none; display: flex; gap: 12px; margin-top: 20px; justify-content: flex-end;">
                    <button onclick="downloadAllPromo()" style="padding: 12px 24px; background: var(--gold); border: none; border-radius: 8px; color: var(--bg); font-weight: 600; cursor: pointer;">Download All Approved</button>
                </div>
            </div>
        </div>
        
        <!-- DISCOVER FEED STAGE -->
        <div class="stage" id="stage-discover">
            <div class="discover-container">
                <div class="discover-header">
                    <button class="back-btn" onclick="goToProjects()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2>Discover</h2>
                    <button class="liked-btn" onclick="showLikedItems()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="var(--accent)" stroke="var(--accent)" stroke-width="2">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        </svg>
                    </button>
                </div>
                
                <div class="swipe-container" id="swipe-container">
                    <div class="swipe-cards" id="swipe-cards">
                        <div class="swipe-card loading-card">
                            <div class="loading-spinner"></div>
                            <p>Loading content...</p>
                        </div>
                    </div>
                    
                    <div class="swipe-actions">
                        <button class="swipe-btn skip-btn" onclick="swipeCard('skip')">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/>
                                <line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                        </button>
                        <button class="swipe-btn feedback-btn" onclick="openFeedbackModal()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            </svg>
                        </button>
                        <button class="swipe-btn like-btn" onclick="swipeCard('like')">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="feedback-hint">Swipe or tap to rate. Give feedback to improve AI.</div>
                </div>
                
                <button class="btn btn-secondary generate-more-btn" onclick="generateMoreContent()">Generate More Content</button>
            </div>
        </div>
        
        <!-- CREATE STAGE - Chat Only -->
        <div class="stage" id="stage-create">
            <div class="chat-messages-container">
                <div class="messages" id="messages">
                </div>
            </div>
        </div>
        
        <!-- PROFILE SETTINGS PAGE -->
        <div class="stage" id="stage-profile">
            <div class="settings-page">
                <div class="back-btn" onclick="goToProjects()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back to projects
                </div>
                
                <div class="settings-header">
                    <h1>Profile</h1>
                    <p>Manage your account information</p>
                </div>
                
                <div class="settings-section">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-large" id="profile-avatar-large">
                            <span id="profile-initial-large">U</span>
                        </div>
                        <div class="profile-avatar-info">
                            <h3 id="profile-display-name">User</h3>
                            <p id="profile-email-display">user@example.com</p>
                        </div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-section-title">Account Information</div>
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <div class="settings-row-label">Email</div>
                            <div class="settings-row-desc">Your login email address</div>
                        </div>
                        <div class="settings-row-value" id="profile-email">user@example.com</div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <div class="settings-row-label">Account Created</div>
                            <div class="settings-row-desc">When you joined Framd</div>
                        </div>
                        <div class="settings-row-value" id="profile-created">-</div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <div class="settings-row-label">Projects Created</div>
                            <div class="settings-row-desc">Total number of projects</div>
                        </div>
                        <div class="settings-row-value" id="profile-projects-count">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- BILLING SETTINGS PAGE -->
        <div class="stage" id="stage-billing">
            <div class="settings-page">
                <div class="back-btn" onclick="goToProjects()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back to projects
                </div>
                
                <div class="settings-header">
                    <h1>Billing</h1>
                    <p>Manage your subscription and payment</p>
                </div>
                
                <div class="billing-plan-card" id="billing-plan-card">
                    <div class="billing-plan-header">
                        <div class="billing-plan-name" id="billing-plan-name">Free Plan</div>
                        <div class="billing-plan-price" id="billing-plan-price">$0<span>/month</span></div>
                    </div>
                    
                    <!-- Token Balance Display -->
                    <div class="token-balance-section" style="background: rgba(255,214,10,0.1); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Token Balance</div>
                                <div style="font-size: 24px; font-weight: 700; color: var(--gold);" id="billing-token-balance">50</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Monthly Allowance</div>
                                <div style="font-size: 16px; color: var(--text);" id="billing-monthly-tokens">50 tokens</div>
                            </div>
                        </div>
                        <div style="background: rgba(0,0,0,0.3); border-radius: 4px; height: 8px; margin-top: 12px; overflow: hidden;">
                            <div id="billing-token-bar" style="background: var(--gold); height: 100%; width: 100%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                    
                    <ul class="billing-features" id="billing-features">
                        <li>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"/>
                            </svg>
                            Script generation
                        </li>
                        <li id="billing-feature-export">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                            Video export
                        </li>
                        <li id="billing-feature-revisions">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                            </svg>
                            Unlimited revisions
                        </li>
                    </ul>
                </div>
                
                <div id="billing-upgrade-section">
                    <button class="settings-btn settings-btn-primary" onclick="showUpgradePrompt()" style="width: 100%; padding: 1rem; font-size: 1rem;">
                        View Plans & Upgrade
                    </button>
                    <p style="text-align: center; color: rgba(255,214,10,0.5); font-size: 0.85rem; margin-top: 0.75rem;">
                        Get more tokens and unlock video export
                    </p>
                </div>
                
                <div id="billing-manage-section" style="display: none;">
                    <button class="settings-btn settings-btn-secondary" onclick="manageSubscription()" style="width: 100%;">
                        Manage Subscription
                    </button>
                </div>
                
                <div class="settings-section" style="margin-top: 1.5rem;">
                    <div class="settings-section-title">Payment History</div>
                    <div id="payment-history">
                        <div class="settings-row">
                            <div class="settings-row-info">
                                <div class="settings-row-desc">No payment history</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- PRIVACY SETTINGS PAGE -->
        <div class="stage" id="stage-privacy">
            <div class="settings-page">
                <div class="back-btn" onclick="goToProjects()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                    Back to projects
                </div>
                
                <div class="settings-header">
                    <h1>Privacy</h1>
                    <p>Control your data and privacy settings</p>
                </div>
                
                <div class="settings-section">
                    <div class="settings-section-title">Data & Learning</div>
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <div class="settings-row-label">AI Learning</div>
                            <div class="settings-row-desc">Allow AI to learn from your style preferences</div>
                        </div>
                        <div class="toggle-switch active" id="toggle-ai-learning" onclick="togglePrivacySetting('ai-learning')"></div>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <div class="settings-row-label">Usage Analytics</div>
                            <div class="settings-row-desc">Help improve Framd with anonymous usage data</div>
                        </div>
                        <div class="toggle-switch active" id="toggle-analytics" onclick="togglePrivacySetting('analytics')"></div>
                    </div>
                </div>
                
                <div class="settings-section">
                    <div class="settings-section-title">Your Data</div>
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <div class="settings-row-label">Export Data</div>
                            <div class="settings-row-desc">Download all your projects and data</div>
                        </div>
                        <button class="settings-btn settings-btn-secondary" onclick="exportUserData()">Export</button>
                    </div>
                    <div class="settings-row">
                        <div class="settings-row-info">
                            <div class="settings-row-label">Delete All Data</div>
                            <div class="settings-row-desc">Permanently delete your account and all data</div>
                        </div>
                        <button class="settings-btn settings-btn-danger" onclick="confirmDeleteAccount()">Delete Account</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Fixed Bottom Chat Bar - Sleek, Full Width -->
        <div class="bottom-chat-bar" id="bottom-chat-bar">
            <div class="bottom-chat-container">
                <div class="bottom-chat-input-wrapper">
                    <textarea 
                        class="bottom-chat-input" 
                        id="composer-input" 
                        placeholder="Prompt, paste, or drop. We'll make the clip."
                        rows="1"
                        onkeydown="handleKeydown(event)"
                        oninput="autoResize(this)"
                    ></textarea>
                    <button class="bottom-chat-send" id="send-btn" onclick="sendMessage()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
                <div class="file-preview" id="file-preview">
                    <span class="file-name" id="file-name"></span>
                    <button class="remove-file" onclick="clearFile()">&times;</button>
                </div>
            </div>
            <input type="file" id="file-input" accept="video/*,audio/*,image/*,.pdf,.txt" onchange="handleFile(event)" style="display:none;">
        </div>
        
        <!-- Image/Video Placement Popup -->
        <div class="image-placement-popup" id="image-placement-popup">
            <div class="image-placement-content">
                <img id="image-placement-preview" class="image-placement-preview" src="" alt="Preview">
                <video id="video-placement-preview" class="image-placement-preview" style="display:none;" muted loop></video>
                <div class="image-placement-analysis" id="image-placement-analysis">
                    Analyzing...
                </div>
                <div class="upload-mode-selector">
                    <div class="mode-option selected" data-mode="curate" onclick="selectUploadMode('curate')">
                        <div class="mode-option-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/><path d="M11 8v6M8 11h6"/></svg></div>
                        <div class="mode-option-label">Use AI Curation</div>
                        <div class="mode-option-desc">AI finds the best visuals for your content</div>
                    </div>
                    <div class="mode-option" data-mode="reskin" onclick="selectUploadMode('reskin')">
                        <div class="mode-option-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg></div>
                        <div class="mode-option-label">AI Remix</div>
                        <div class="mode-option-desc">Clip guides visuals, AI regenerates with your topic</div>
                    </div>
                    <div class="mode-option" data-mode="clipper" onclick="selectUploadMode('clipper')">
                        <div class="mode-option-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg></div>
                        <div class="mode-option-label">Next Gen Clipper</div>
                        <div class="mode-option-desc">Script leads, AI clips according to template</div>
                    </div>
                </div>
                
                <!-- AI Remix Options (shown when personalize mode selected) -->
                <div class="reskin-options-section" id="reskin-options-section" style="display: none;">
                    <div style="font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px;">AI Remix Options</div>
                    
                    <!-- Topic Input -->
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 6px;">What's this video about?</label>
                        <input type="text" id="reskin-topic-input" placeholder="e.g., My SaaS product, Coffee shop ad, Fitness tips..." 
                            style="width: 100%; padding: 12px 14px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px;">
                    </div>
                    
                    <!-- Caption Position -->
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">Caption Position</label>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="caption-pos-btn" data-pos="top" onclick="selectCaptionPosition('top')" style="flex: 1; padding: 10px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 13px;">Top</button>
                            <button type="button" class="caption-pos-btn" data-pos="center" onclick="selectCaptionPosition('center')" style="flex: 1; padding: 10px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 13px;">Center</button>
                            <button type="button" class="caption-pos-btn selected" data-pos="bottom" onclick="selectCaptionPosition('bottom')" style="flex: 1; padding: 10px; background: var(--gold-muted); border: 1px solid var(--gold); border-radius: 8px; color: var(--gold); cursor: pointer; font-size: 13px;">Bottom</button>
                        </div>
                    </div>
                    
                    <!-- Custom Voiceover Upload -->
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">Voiceover</label>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="voice-mode-btn selected" data-mode="ai" onclick="selectVoiceMode('ai')" style="flex: 1; padding: 10px; background: var(--gold-muted); border: 1px solid var(--gold); border-radius: 8px; color: var(--gold); cursor: pointer; font-size: 13px;">AI Voice</button>
                            <button type="button" class="voice-mode-btn" data-mode="custom" onclick="selectVoiceMode('custom')" style="flex: 1; padding: 10px; background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 13px;">Upload My Own</button>
                        </div>
                        <div id="custom-voice-upload" style="display: none; margin-top: 10px;">
                            <input type="file" id="custom-voiceover-file" accept="audio/*" onchange="handleCustomVoiceover(this)" style="display: none;">
                            <button type="button" onclick="document.getElementById('custom-voiceover-file').click()" style="width: 100%; padding: 12px; background: var(--card-bg); border: 1px dashed var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 13px;">
                                <span id="custom-voice-label">Click to upload audio file</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Color Grade -->
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">Visual Style</label>
                        <select id="reskin-color-grade" style="width: 100%; padding: 12px 14px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px; cursor: pointer;">
                            <option value="cinematic" selected>Cinematic (Film Look)</option>
                            <option value="warm">Warm (Golden Hour)</option>
                            <option value="cool">Cool (Modern/Tech)</option>
                            <option value="vibrant">Vibrant (High Energy)</option>
                            <option value="muted">Muted (Documentary)</option>
                            <option value="vintage">Vintage (Retro Film)</option>
                            <option value="none">None (Keep Original)</option>
                        </select>
                    </div>
                    
                    <!-- Caption Style -->
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">Caption Style</label>
                        <select id="reskin-caption-style" style="width: 100%; padding: 12px 14px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 14px; cursor: pointer;">
                            <option value="bold_pop" selected>Bold Pop (Word-by-word highlight)</option>
                            <option value="clean_minimal">Clean Minimal (Subtle fade)</option>
                            <option value="gradient_glow">Gradient Glow (Golden emphasis)</option>
                            <option value="street_style">Street Style (High impact)</option>
                            <option value="boxed">Boxed (Clean background)</option>
                        </select>
                    </div>
                    
                    <!-- Custom Images -->
                    <div style="margin-bottom: 8px;">
                        <label style="display: block; font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">Custom Images (Optional)</label>
                        <input type="file" id="custom-images-input" accept="image/*" multiple onchange="handleCustomImages(this)" style="display: none;">
                        <button type="button" onclick="document.getElementById('custom-images-input').click()" style="width: 100%; padding: 12px; background: var(--card-bg); border: 1px dashed var(--border); border-radius: 8px; color: var(--text-secondary); cursor: pointer; font-size: 13px;">
                            <span id="custom-images-label">Add images AI should include</span>
                        </button>
                        <div id="custom-images-preview" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;"></div>
                    </div>
                </div>
                
                <div class="image-placement-options" id="placement-options-section">
                    <div class="placement-option selected" data-placement="background" onclick="selectPlacement('background')">
                        <div class="placement-option-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg></div>
                        <div class="placement-option-label">Full Background</div>
                        <div class="placement-option-desc">Behind text overlay</div>
                    </div>
                    <div class="placement-option" data-placement="popup" onclick="selectPlacement('popup')">
                        <div class="placement-option-icon"><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
                        <div class="placement-option-label">Pop-up Visual</div>
                        <div class="placement-option-desc">Overlay element</div>
                    </div>
                </div>
                <div class="content-rights-section" id="content-rights-section">
                    <div class="rights-info-box">
                        <div class="rights-info-header">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--gold)" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                            <span>Your Content, Your Rights</span>
                        </div>
                        <p class="rights-info-text">AI learns from your preferences to improve suggestions — we never take ownership of your content.</p>
                        <a href="/terms#ai-learning" target="_blank" class="rights-learn-more">Learn exactly how AI learning works</a>
                    </div>
                    <div class="content-rights-checkbox">
                        <label class="checkbox-container">
                            <input type="checkbox" id="content-rights-check" onchange="updateConfirmButton()">
                            <span class="checkmark"></span>
                            <span class="checkbox-text">I have rights to use this content and accept responsibility for any consequences</span>
                        </label>
                    </div>
                </div>
                <div class="image-placement-actions">
                    <button class="image-placement-cancel" onclick="cancelImagePlacement()">Cancel</button>
                    <button class="image-placement-confirm" id="confirm-upload-btn" onclick="confirmImagePlacement()" disabled>Use File</button>
                </div>
            </div>
        </div>
        
        <!-- Scene Visual Picker Popup -->
        <div class="scene-visual-popup" id="scene-visual-popup">
            <div class="scene-visual-popup-inner">
                <div class="scene-visual-popup-header">
                    <h3 id="scene-visual-title">Scene 1: HOOK</h3>
                    <button class="scene-visual-close" onclick="closeSceneVisualPopup()">&times;</button>
                </div>
                <div class="scene-visual-concept" id="scene-visual-concept"></div>
                <div class="scene-visual-grid" id="scene-visual-grid">
                    <div class="loading-visuals">Finding visuals...</div>
                </div>
            </div>
        </div>
        
        <!-- Stage Directions Confirmation Modal -->
        <div class="confirm-modal" id="stage-directions-confirm">
            <div class="confirm-content">
                <h3>No Stage Directions</h3>
                <p>Stage directions are empty. Video will be generated without effects.</p>
                <div class="confirm-buttons">
                    <button class="btn-confirm-yes" onclick="confirmGenerateNoDirections()">Yes, continue</button>
                    <button class="btn-confirm-no" onclick="closeStageDirectionsConfirm()">No, add directions</button>
                </div>
            </div>
        </div>
        
        <!-- REVIEW STAGE -->
        <div class="stage" id="stage-review">
            <div class="review-content" id="review-content">
                <!-- WORKFLOW CARD 1: SCRIPT -->
                <div class="workflow-card" id="workflow-card-script" style="display:block;">
                <div class="script-card" id="script-card">
                    <div class="script-card-header">
                        <div class="script-card-meta">
                            <span class="script-title" id="script-card-title">Your Script</span>
                            <div class="script-stats">
                                <span class="script-stat" id="script-duration">0s</span>
                                <span class="script-stat" id="script-scenes">0 scenes</span>
                                <span class="script-quality-badge" id="script-quality" style="display:none;">0</span>
                            </div>
                        </div>
                        <div class="script-card-actions">
                            <button class="btn btn-secondary btn-sm" id="script-edit-btn" onclick="toggleScriptEdit()" style="display:none;">Edit</button>
                            <button class="btn btn-primary btn-sm" id="script-confirm-btn" onclick="confirmScriptEdit()" style="display:none;">Confirm Changes</button>
                            <button class="btn btn-secondary btn-sm rebuild-btn" onclick="rebuildScript()">Rebuild</button>
                        </div>
                    </div>
                    <div class="script-card-hook" id="script-hook">
                        <span class="hook-label">Hook:</span>
                        <span class="hook-text" id="script-hook-text">Script will appear here after AI generates it...</span>
                    </div>
                    <div class="script-card-body">
                        <pre id="script-text" class="script-content">Script will appear here after AI generates it...</pre>
                        <textarea id="script-edit-area" class="script-edit-area" style="display:none;"></textarea>
                    </div>
                    <div class="workflow-card-footer">
                        <button class="btn btn-primary" onclick="advanceToCard('visuals')">Continue to Visuals</button>
                    </div>
                </div>
                </div>
                
                <!-- WORKFLOW CARD 2: VISUALS (simplified - visuals picked in anchor cards) -->
                <div class="workflow-card" id="workflow-card-visuals" style="display:none;">
                    <div class="section-title">Scene Visuals</div>
                    <div class="visual-summary" id="visual-summary">
                        <p style="color: var(--text-dim); text-align: center; padding: 1rem;">
                            Pick visuals for each scene. Click the button below to open the visual picker.
                        </p>
                        <button class="btn btn-secondary" id="visual-picker-toggle" onclick="openVisualPicker()" style="margin: 1rem auto; display: block;">
                            Curate Visuals
                        </button>
                        <div id="anchor-cards-container" style="margin-top: 1rem; display: none;"></div>
                    </div>
                    <div class="workflow-card-footer" id="visuals-footer" style="display: none;">
                        <button class="btn btn-primary" onclick="advanceToCard('voices')">Continue to Voice Casting</button>
                    </div>
                </div>
                
                <!-- WORKFLOW CARD 3: VOICES -->
                <div class="workflow-card" id="workflow-card-voices" style="display:none;">
                
                <div class="section-title">Voice Casting & Characters <span id="voice-count" class="voice-count"></span></div>
                <div class="casting-panel" id="casting-panel">
                    <div class="casting-characters" id="casting-characters">
                        <div class="character-cast">
                            <div class="cast-info">
                                <div class="cast-name">NARRATOR</div>
                                <div class="cast-desc">Default narrator</div>
                            </div>
                            <div class="cast-voice-row">
                                <select class="cast-voice" id="voice-NARRATOR" onchange="handleVoiceChange('NARRATOR', this.value)">
                                    <option value="the_anchor" selected>The Anchor</option>
                                    <option value="british_authority">British Authority</option>
                                    <option value="the_storyteller">The Storyteller</option>
                                    <option value="aussie_casual">Aussie Casual</option>
                                    <option value="power_exec">Power Exec</option>
                                    <option value="documentary_pro">Documentary Pro</option>
                                    <option value="hype_machine">Hype Machine</option>
                                    <option value="cinema_epic">Cinema Epic</option>
                                    <option value="whisper_intimate">Whisper Intimate</option>
                                    <option value="zen_guide">Zen Guide</option>
                                    <option value="warm_narrator">Warm Narrator</option>
                                    <option value="countdown_king">Countdown King</option>
                                    <option value="custom">Custom Voice</option>
                                </select>
                                <button class="voice-preview-btn" onclick="previewVoice(document.getElementById('voice-NARRATOR').value)" title="Preview voice">&#9654;</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-secondary detect-chars-btn" onclick="detectCharacters()">Detect Characters</button>
                    
                    <div class="voice-char-preview" id="voice-char-preview" style="margin-top: 0.75rem; padding: 0.5rem; background: rgba(255,214,10,0.1); border-radius: 6px; font-size: 0.8rem; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Voice characters: <strong id="voice-char-count">0</strong></span>
                            <button class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.7rem;" onclick="previewVoiceChars()">Refresh Count</button>
                        </div>
                        <div id="voice-char-text" style="margin-top: 0.5rem; font-size: 0.7rem; color: var(--text-dim); max-height: 60px; overflow-y: auto;"></div>
                    </div>
                    
                    <div class="character-layers-inline">
                        <div class="layers-subtitle">Character Layers</div>
                        <div class="models-grid" id="models-grid">
                            <div class="no-models-msg">No characters extracted yet. Detect characters above.</div>
                        </div>
                    </div>
                </div>
                    <div class="workflow-card-footer">
                        <button class="btn btn-primary" onclick="advanceToCard('soundfx')">Continue to Sound FX</button>
                    </div>
                </div>
                
                <!-- WORKFLOW CARD 4: SOUND FX -->
                <div class="workflow-card" id="workflow-card-soundfx" style="display:none;">
                    <div class="section-title">Sound FX & Stage Directions</div>
                    <div class="stage-directions-panel" id="stage-directions-panel">
                        <div class="stage-directions-info">Timing: [PAUSE], [BEAT], [SILENCE]. Sound FX: [SOUND: whoosh], [SOUND: impact], [SOUND: tension], [SOUND: reveal]. SFX are auto-mixed into final video.</div>
                        <textarea class="stage-directions-input" id="stage-directions-input" placeholder="[PAUSE 1s]&#10;[BEAT]&#10;[SOUND: whoosh]&#10;[SOUND: impact]&#10;[SOUND: tension 2s]&#10;[SILENCE 2s]" oninput="updateSfxTokenBadge()"></textarea>
                        <div class="stage-directions-actions">
                            <button class="btn btn-secondary btn-sm" onclick="generateStageDirections()">Generate Directions</button>
                        </div>
                    </div>
                    <div class="workflow-card-footer">
                        <button class="btn btn-primary" onclick="advanceToCard('format')">Continue to Format</button>
                    </div>
                </div>
                
                <!-- WORKFLOW CARD 5: FORMAT -->
                <div class="workflow-card" id="workflow-card-format" style="display:none;">
                <div class="section-title">Format</div>
                <div class="format-grid" id="format-grid">
                    <div class="format-option selected" data-format="9:16" onclick="selectFormat(this)">9:16 Reel</div>
                    <div class="format-option" data-format="1:1" onclick="selectFormat(this)">1:1 Square</div>
                    <div class="format-option" data-format="16:9" onclick="selectFormat(this)">16:9 Wide</div>
                </div>
                    <div class="workflow-card-footer">
                        <button class="btn btn-primary" onclick="advanceToCard('captions')">Continue to Captions</button>
                    </div>
                </div>
                
                <!-- WORKFLOW CARD 6: CAPTIONS -->
                <div class="workflow-card" id="workflow-card-captions" style="display:none;">
                <div class="caption-section">
                    <div class="section-title" style="margin-top: 1.5rem;">Captions</div>
                    
                    <!-- Caption Style Templates with Refresh/History -->
                    <div class="caption-style-picker" id="caption-style-picker">
                        <div class="caption-style-header">
                            <span class="caption-style-title">AI Recommended Style</span>
                            <div class="caption-style-nav">
                                <button class="style-nav-btn" id="style-back-btn" onclick="navigateCaptionHistory(-1)" disabled title="Previous style">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                                </button>
                                <button class="style-nav-btn" id="style-refresh-btn" onclick="refreshCaptionStyle()" title="Try different style">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>
                                </button>
                                <button class="style-nav-btn" id="style-forward-btn" onclick="navigateCaptionHistory(1)" disabled title="Next style">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="caption-style-cards" id="caption-style-cards">
                            <div class="caption-style-card selected" data-style="bold_pop" onclick="selectCaptionStyle('bold_pop', this)">
                                <div class="style-preview bold-pop-preview">
                                    <span class="preview-word">This</span>
                                    <span class="preview-word highlight">is</span>
                                    <span class="preview-word">bold</span>
                                </div>
                                <div class="style-name">Bold Pop</div>
                            </div>
                            <div class="caption-style-card" data-style="clean_minimal" onclick="selectCaptionStyle('clean_minimal', this)">
                                <div class="style-preview clean-minimal-preview">
                                    <span class="preview-word">Clean</span>
                                    <span class="preview-word highlight">and</span>
                                    <span class="preview-word">minimal</span>
                                </div>
                                <div class="style-name">Clean Minimal</div>
                            </div>
                            <div class="caption-style-card" data-style="boxed" onclick="selectCaptionStyle('boxed', this)">
                                <div class="style-preview boxed-preview">
                                    <span class="preview-word boxed-word">Text with</span>
                                    <span class="preview-word boxed-word highlight">box</span>
                                </div>
                                <div class="style-name">Boxed</div>
                            </div>
                            <div class="caption-style-card" data-style="gradient_glow" onclick="selectCaptionStyle('gradient_glow', this)">
                                <div class="style-preview gradient-glow-preview">
                                    <span class="preview-word glow">Gradient</span>
                                    <span class="preview-word glow highlight">glow</span>
                                </div>
                                <div class="style-name">Gradient Glow</div>
                            </div>
                            <div class="caption-style-card" data-style="street_style" onclick="selectCaptionStyle('street_style', this)">
                                <div class="style-preview street-style-preview">
                                    <span class="preview-word street">STREET</span>
                                    <span class="preview-word street highlight">STYLE</span>
                                </div>
                                <div class="style-name">Street Style</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="caption-container">
                        <div class="caption-controls">
                            <div class="caption-control-group">
                                <div class="caption-control-label">Font</div>
                                <div class="font-selector" id="font-selector">
                                    <div class="font-option selected" data-font="'Bebas Neue', sans-serif" onclick="selectCaptionFont(this)">
                                        <div class="font-option-preview" style="font-family: 'Bebas Neue', sans-serif;">THE QUICK FOX</div>
                                        <div class="font-option-name">Bebas Neue</div>
                                    </div>
                                    <div class="font-option" data-font="'Montserrat', sans-serif" onclick="selectCaptionFont(this)">
                                        <div class="font-option-preview" style="font-family: 'Montserrat', sans-serif; font-weight: 900;">THE QUICK FOX</div>
                                        <div class="font-option-name">Montserrat</div>
                                    </div>
                                    <div class="font-option" data-font="'Anton', sans-serif" onclick="selectCaptionFont(this)">
                                        <div class="font-option-preview" style="font-family: 'Anton', sans-serif;">THE QUICK FOX</div>
                                        <div class="font-option-name">Anton</div>
                                    </div>
                                    <div class="font-option" data-font="'Oswald', sans-serif" onclick="selectCaptionFont(this)">
                                        <div class="font-option-preview" style="font-family: 'Oswald', sans-serif; font-weight: 700;">THE QUICK FOX</div>
                                        <div class="font-option-name">Oswald</div>
                                    </div>
                                    <div class="font-option" data-font="'Poppins', sans-serif" onclick="selectCaptionFont(this)">
                                        <div class="font-option-preview" style="font-family: 'Poppins', sans-serif; font-weight: 800;">THE QUICK FOX</div>
                                        <div class="font-option-name">Poppins</div>
                                    </div>
                                    <div class="font-option" data-font="'Bangers', cursive" onclick="selectCaptionFont(this)">
                                        <div class="font-option-preview" style="font-family: 'Bangers', cursive;">THE QUICK FOX</div>
                                        <div class="font-option-name">Bangers</div>
                                    </div>
                                    <div class="font-option" data-font="'Archivo Black', sans-serif" onclick="selectCaptionFont(this)">
                                        <div class="font-option-preview" style="font-family: 'Archivo Black', sans-serif;">THE QUICK FOX</div>
                                        <div class="font-option-name">Archivo Black</div>
                                    </div>
                                    <div class="font-option" data-font="'Roboto Condensed', sans-serif" onclick="selectCaptionFont(this)">
                                        <div class="font-option-preview" style="font-family: 'Roboto Condensed', sans-serif; font-weight: 700;">THE QUICK FOX</div>
                                        <div class="font-option-name">Roboto Condensed</div>
                                    </div>
                                </div>
                            </div>
                            <div class="caption-control-group">
                                <div class="caption-control-label">Text Color</div>
                                <div class="caption-colors" id="caption-colors">
                                    <div class="color-preset selected" data-color="#FFFFFF" style="background:#FFFFFF" onclick="selectCaptionColor(this)" title="White"></div>
                                    <div class="color-preset" data-color="#FFD60A" style="background:#FFD60A" onclick="selectCaptionColor(this)" title="Yellow"></div>
                                    <div class="color-preset" data-color="#FF3B30" style="background:#FF3B30" onclick="selectCaptionColor(this)" title="Red"></div>
                                    <div class="color-preset" data-color="#00D4FF" style="background:#00D4FF" onclick="selectCaptionColor(this)" title="Cyan"></div>
                                    <div class="color-preset" data-color="#ffd60a" style="background:#ffd60a" onclick="selectCaptionColor(this)" title="Gold"></div>
                                    <div class="color-preset" data-color="#FF9500" style="background:#FF9500" onclick="selectCaptionColor(this)" title="Orange"></div>
                                    <div class="color-preset" data-color="#FF69B4" style="background:#FF69B4" onclick="selectCaptionColor(this)" title="Pink"></div>
                                    <div class="color-preset" data-color="#BF5AF2" style="background:#BF5AF2" onclick="selectCaptionColor(this)" title="Purple"></div>
                                </div>
                            </div>
                            <div class="caption-control-group">
                                <div class="caption-control-label">Position</div>
                                <div class="caption-position-selector" id="caption-position-selector">
                                    <button class="position-btn" data-position="top" onclick="selectCaptionPosition(this)">Top</button>
                                    <button class="position-btn selected" data-position="center" onclick="selectCaptionPosition(this)">Center</button>
                                    <button class="position-btn" data-position="bottom" onclick="selectCaptionPosition(this)">Bottom</button>
                                </div>
                            </div>
                            <div class="caption-control-group">
                                <div class="caption-control-label">Animation</div>
                                <select class="caption-select" id="caption-animation" onchange="updateCaptionAnimation(this.value)">
                                    <option value="none">None</option>
                                    <option value="highlight" selected>Word Highlight</option>
                                    <option value="bounce">Bounce (Preview)</option>
                                    <option value="karaoke">Karaoke Fill (Preview)</option>
                                    <option value="typewriter">Typewriter (Preview)</option>
                                </select>
                            </div>
                            <div class="caption-control-group" id="highlight-color-group">
                                <div class="caption-control-label">Highlight Color</div>
                                <div class="caption-colors" id="highlight-colors">
                                    <div class="color-preset selected" data-color="#FFD60A" style="background:#FFD60A" onclick="selectHighlightColor(this)" title="Yellow"></div>
                                    <div class="color-preset" data-color="#00D4FF" style="background:#00D4FF" onclick="selectHighlightColor(this)" title="Cyan"></div>
                                    <div class="color-preset" data-color="#FF3B30" style="background:#FF3B30" onclick="selectHighlightColor(this)" title="Red"></div>
                                    <div class="color-preset" data-color="#ffd60a" style="background:#ffd60a" onclick="selectHighlightColor(this)" title="Gold"></div>
                                    <div class="color-preset" data-color="#FF69B4" style="background:#FF69B4" onclick="selectHighlightColor(this)" title="Pink"></div>
                                    <div class="color-preset" data-color="#BF5AF2" style="background:#BF5AF2" onclick="selectHighlightColor(this)" title="Purple"></div>
                                </div>
                            </div>
                            <div class="caption-control-group">
                                <div class="caption-control-label">Effects</div>
                                <div class="caption-toggles">
                                    <label class="toggle-pill active" onclick="toggleCaptionPill(this)">
                                        <input type="checkbox" id="caption-shadow" checked> Shadow
                                    </label>
                                    <label class="toggle-pill active" onclick="toggleCaptionPill(this)">
                                        <input type="checkbox" id="caption-outline" checked> Outline
                                    </label>
                                    <label class="toggle-pill active" onclick="toggleCaptionPill(this)">
                                        <input type="checkbox" id="caption-uppercase" checked> CAPS
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="caption-phone-frame">
                            <div class="caption-preview" id="caption-preview">
                                <div class="caption-preview-label">Live Preview</div>
                                <div class="caption-text-preview shadow outline" id="caption-text-preview" style="color:#FFFFFF; font-family: 'Bebas Neue', sans-serif;">
                                    <span class="caption-word">THE</span> <span class="caption-word highlight">QUICK</span> <span class="caption-word">BROWN</span> <span class="caption-word">FOX</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    <div class="workflow-card-footer" style="margin-top: 1rem;">
                        <button class="btn btn-primary" id="generate-btn" onclick="generateVideo()">Generate Video — <span id="token-cost">25</span> tokens (<span id="dollar-cost">~$1.56</span>)</button>
                    </div>
                </div>
                
            </div>
        </div>
        
        <!-- EXPORT STAGE -->
        <div class="stage" id="stage-export">
            <div class="export-content">
                <div class="export-preview" id="export-preview">
                    <div class="phone-frame">
                        <div class="phone-screen">
                            <video id="export-video" controls></video>
                        </div>
                    </div>
                    <div class="format-indicator" id="format-indicator">9:16 Portrait</div>
                </div>
                
                <!-- Like/Dislike Section -->
                <div class="video-feedback-actions" id="video-feedback-actions">
                    <div class="like-dislike-container">
                        <button class="like-btn" id="like-btn" onclick="handleVideoLike(true)">
                            <span class="like-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg></span>
                            <span>I like it</span>
                        </button>
                        <button class="dislike-btn" id="dislike-btn" onclick="handleVideoLike(false)">
                            <span class="dislike-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"/></svg></span>
                            <span>Not quite</span>
                        </button>
                    </div>
                    <div id="revision-counter" class="revision-counter" style="display: none;">
                        <span id="revisions-left">3</span> revisions remaining
                    </div>
                </div>
                
                <!-- Dislike Comment Flow (hidden by default) -->
                <div class="dislike-comment-flow" id="dislike-comment-flow" style="display: none;">
                    <div class="dislike-header">
                        <span class="dislike-icon-header"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg></span>
                        <span>Tell me what to fix</span>
                    </div>
                    <textarea id="dislike-comment" class="dislike-comment-input" placeholder="What's not working? Be specific — e.g. 'pacing is too slow', 'voice sounds robotic', 'wrong visual style'..." rows="3"></textarea>
                    <button class="btn btn-accent" id="send-to-ai-btn" onclick="sendBackToAI()">Send Back to AI</button>
                    <button class="btn btn-secondary" style="margin-top: 0.5rem;" onclick="cancelDislike()">Cancel</button>
                </div>
                
                <!-- Action Buttons -->
                <div class="export-action-buttons" id="export-action-buttons">
                    <button class="btn btn-primary" onclick="downloadVideo()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Download
                    </button>
                    <button class="btn btn-secondary" style="margin-top: 0.75rem;" onclick="hostAndShare()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>Share
                    </button>
                </div>
                
                <div id="share-url-container" style="display: none; margin-top: 1rem;">
                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem;">Share URL:</div>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="share-url-input" readonly style="flex: 1; background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 0.5rem; color: var(--text); font-size: 0.85rem;">
                        <button class="btn btn-secondary" onclick="copyShareUrl()" style="padding: 0.5rem 1rem;">Copy</button>
                    </div>
                </div>
                
                <button class="btn btn-secondary" style="margin-top: 1rem; opacity: 0.7;" onclick="startOver()">Start New Project</button>
            </div>
        </div>
        
    </div>
    
    <div class="toast" id="toast"></div>
    
    <!-- AI Reflection Modal -->
    <div class="reflection-modal" id="reflection-modal">
        <div class="reflection-content">
            <div class="reflection-header">
                <div class="reflection-avatar">🧠</div>
                <div>
                    <div class="reflection-title">Echo Engine Reflection</div>
                    <div class="reflection-subtitle">Here's what I learned from this project</div>
                </div>
            </div>
            
            <div class="reflection-body">
                <div class="reflection-section">
                    <div class="reflection-section-title">What I Learned</div>
                    <div class="reflection-section-content" id="reflection-learned">
                        Analyzing your feedback...
                    </div>
                </div>
                
                <div class="reflection-section">
                    <div class="reflection-section-title">What I Can Improve</div>
                    <div class="reflection-section-content" id="reflection-improve">
                        Identifying areas for growth...
                    </div>
                </div>
            </div>
            
            <div class="learning-progress-bar">
                <div class="learning-progress-header">
                    <span class="learning-progress-label">Learning Progress</span>
                    <span class="learning-progress-value" id="learning-progress-value">0%</span>
                </div>
                <div class="learning-progress-track">
                    <div class="learning-progress-fill" id="learning-progress-fill" style="width: 0%"></div>
                </div>
                <div class="learning-gain" id="learning-gain" style="display: none;">+0% from this project</div>
            </div>
            
            <div class="auto-gen-unlock" id="auto-gen-unlock" style="display: none;">
                <div class="auto-gen-unlock-title">Auto-Generation Unlocked!</div>
                <div class="auto-gen-unlock-desc">I've learned enough about your style to draft projects automatically.</div>
            </div>
            
            <button class="btn btn-primary reflection-close" onclick="closeReflectionModal()">Continue</button>
        </div>
    </div>
    
    <!-- Loading overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content" style="max-width: 400px; width: 90%;">
            <div class="loading-spinner"></div>
            <div class="loading-title">Rendering your video</div>
            <div class="loading-timer" id="loading-timer">0:00</div>
            
            <!-- Progress Bar -->
            <div style="margin: 20px 0;">
                <div style="background: rgba(255,255,255,0.1); border-radius: 8px; height: 8px; overflow: hidden;">
                    <div id="render-progress-bar" style="width: 0%; height: 100%; background: linear-gradient(90deg, var(--gold) 0%, #f0c000 100%); border-radius: 8px; transition: width 0.5s ease;"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 12px;">
                    <div id="step-voice" class="render-step" style="text-align: center; opacity: 0.4; transition: opacity 0.3s;">
                        <div style="margin-bottom: 4px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg></div>
                        <div style="font-size: 10px; color: var(--text-dim);">Voice</div>
                    </div>
                    <div id="step-scenes" class="render-step" style="text-align: center; opacity: 0.4; transition: opacity 0.3s;">
                        <div style="margin-bottom: 4px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="7" x2="7" y2="7"/><line x1="2" y1="17" x2="7" y2="17"/><line x1="17" y1="17" x2="22" y2="17"/><line x1="17" y1="7" x2="22" y2="7"/></svg></div>
                        <div style="font-size: 10px; color: var(--text-dim);">Scenes</div>
                    </div>
                    <div id="step-captions" class="render-step" style="text-align: center; opacity: 0.4; transition: opacity 0.3s;">
                        <div style="margin-bottom: 4px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/><line x1="7" y1="8" x2="17" y2="8"/><line x1="7" y1="12" x2="13" y2="12"/></svg></div>
                        <div style="font-size: 10px; color: var(--text-dim);">Captions</div>
                    </div>
                    <div id="step-render" class="render-step" style="text-align: center; opacity: 0.4; transition: opacity 0.3s;">
                        <div style="margin-bottom: 4px;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg></div>
                        <div style="font-size: 10px; color: var(--text-dim);">Render</div>
                    </div>
                </div>
            </div>
            
            <div class="loading-status" id="loading-status" style="margin-top: 16px;">Generating voiceover...</div>
        </div>
    </div>
    
    <!-- Unified Loader (simplified) -->
    <div class="unified-loader" id="unified-loader">
        <div class="unified-loader-content" style="text-align: center; padding: 40px;">
            <div class="unified-loader-spinner" style="margin: 0 auto 24px;">
                <svg width="48" height="48" viewBox="0 0 48 48" style="animation: spin 1s linear infinite;">
                    <circle cx="24" cy="24" r="20" fill="none" stroke="rgba(255,214,10,0.2)" stroke-width="4"></circle>
                    <circle cx="24" cy="24" r="20" fill="none" stroke="var(--gold)" stroke-width="4" stroke-dasharray="80" stroke-dashoffset="60" stroke-linecap="round"></circle>
                </svg>
            </div>
            <div class="unified-loader-status" id="unified-loader-status" style="font-size: 16px; color: var(--text);">Creating your video...</div>
            <div id="unified-loader-title" style="display: none;"></div>
            <div id="unified-loader-ring" style="display: none;"></div>
            <div id="ring-progress" style="display: none;"></div>
            <div id="unified-loader-fill" style="display: none;"></div>
            <div id="unified-loader-steps" style="display: none;"></div>
            <div id="unified-loader-email" style="display: none;"></div>
        </div>
    </div>
    
    <!-- Persistent Chat Panel (hidden - replaced by bottom bar) -->
    <button class="chat-toggle" id="chat-toggle" onclick="toggleChatPanel()" style="display:none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <span class="chat-badge" id="chat-badge">0</span>
    </button>
    
    <div class="chat-panel" id="chat-panel" style="display:none;">
        <div class="chat-panel-header">
            <div class="chat-panel-title">Echo Engine</div>
            <button class="chat-panel-close" onclick="toggleChatPanel()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="chat-panel-messages" id="chat-panel-messages">
            <div class="message ai">
                <div class="message-content">What would you like to create?</div>
            </div>
        </div>
        <div class="chat-panel-input">
            <input type="text" id="chat-panel-input" placeholder="Ask anything..." onkeypress="if(event.key==='Enter')sendChatPanelMessage()">
            <button onclick="sendChatPanelMessage()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>
    
    
    <!-- Feedback Modal -->
    <div class="feedback-modal" id="feedback-modal" onclick="if(event.target === this) closeFeedbackModal()">
        <div class="feedback-modal-content">
            <h3>Give Feedback</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">What could make this content better? Your feedback helps the AI improve.</p>
            <textarea id="feedback-text" placeholder="e.g., Hook is too long, needs more punch, different topic angle..."></textarea>
            <div class="feedback-modal-actions">
                <button class="btn btn-secondary" onclick="closeFeedbackModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitFeedback()">Submit & Like</button>
            </div>
        </div>
    </div>
    
    <!-- Liked Items Sidebar -->
    <div class="liked-sidebar" id="liked-sidebar">
        <div class="liked-sidebar-header">
            <h3>Liked Content</h3>
            <button class="back-btn" onclick="closeLikedSidebar()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
        </div>
        <div class="liked-items-list" id="liked-items-list">
            <p style="text-align: center; color: var(--text-secondary);">Loading...</p>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- Full Page Render Overlay -->
    <div id="render-overlay" class="render-overlay">
        <div class="render-overlay-content">
            <div class="render-spinner"></div>
            <div class="render-title">AI Remix in Progress</div>
            <div class="render-stage" id="render-stage">Initializing...</div>
            <div class="render-substage" id="render-substage">Please wait while we create your video</div>
            <button class="render-cancel-btn" onclick="cancelRender()">Cancel</button>
        </div>
    </div>
    
    <!-- App Footer -->
    <div class="app-footer">
        <div class="app-footer-content">
            <a href="/terms">Terms</a>
            <span class="separator">|</span>
            <a href="/privacy">Privacy</a>
            <span class="separator">|</span>
            <a href="/faq">FAQ</a>
            <span class="separator">|</span>
            <a href="mailto:support@framd.com">Contact</a>
            <span class="separator">|</span>
            <div class="social-links">
                <a href="https://twitter.com/framdapp" target="_blank" rel="noopener" title="Twitter">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
                </a>
                <a href="https://instagram.com/framdapp" target="_blank" rel="noopener" title="Instagram">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5"/><circle cx="12" cy="12" r="4"/><circle cx="18" cy="6" r="1.5" fill="currentColor" stroke="none"/></svg>
                </a>
                <a href="https://tiktok.com/@framdapp" target="_blank" rel="noopener" title="TikTok">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.59 6.69a4.83 4.83 0 01-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 01-5.2 1.74 2.89 2.89 0 012.31-4.64 2.93 2.93 0 01.88.13V9.4a6.84 6.84 0 00-1-.05A6.33 6.33 0 005 20.1a6.34 6.34 0 0010.86-4.43v-7a8.16 8.16 0 004.77 1.52v-3.4a4.85 4.85 0 01-1-.1z"/></svg>
                </a>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
